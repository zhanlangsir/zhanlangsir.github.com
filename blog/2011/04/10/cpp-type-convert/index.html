
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>C++常用数据类型转换 - 挨踢人生</title>
  <meta name="author" content="zhanlang">

  
  <meta name="description" content="我们先定义一些常见类型变量借以说明 int i = 100; long l = 2001; float f=300.2; double d=12345.119; char username[]= &#8220;aitilife&#8221;; char temp[200]; char *buf; &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://zhanlangsir.github.com/blog/2011/04/10/cpp-type-convert/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="挨踢人生" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">挨踢人生</a></h1>
  
    <h2>做一个有思想的人</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:zhanlangsir.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">C++常用数据类型转换</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-10T00:00:00+08:00" pubdate data-updated="true">Apr 10<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><span style="font-size: 14px; text-align: justify;">我们先定义一些常见类型变量借以说明</span></p>

<p>int i = 100;</p>

<p>long l = 2001;</p>

<p>float f=300.2;</p>

<p>double d=12345.119;</p>

<p>char username[]= &#8220;aitilife&#8221;;</p>

<p>char temp[200]; char *buf;</p>

<p>CString str;</p>

<p>_variant_t v1;</p>

<p><em>bstr_t v2;
一、其它数据类型转换为字符串[more]
短整型(int)
itoa(i,temp,10);///将i转换为字符串放入temp中,最后一个数字表示十进制
itoa(i,temp,2);   ///按二进制方式转换
长整型(long)
ltoa(l,temp,10);
浮点数(float,double)
用fcvt可以完成转换,这是MSDN中的例子:
int   decimal,   sign;
char   *buffer;
double   source   =   3.1415926535;
buffer   =   </em>fcvt(   source,   7,   &amp;decimal,   &amp;sign   );
运行结果:source:   3.1415926535   buffer:   ’31415927 ‘   decimal:   1   sign:   0
decimal表示小数点的位置,sign表示符号:0为正数，1为负数
CString变量
str   =   “2008北京奥运 “;
buf   =   (LPSTR)(LPCTSTR)str;
BSTR变量
BSTR   bstrValue   =   ::SysAllocString(L “程序员 “);
char   *   buf   =   <em>com_util::ConvertBSTRToString(bstrValue);
SysFreeString(bstrValue);
AfxMessageBox(buf);
delete(buf);
CComBSTR变量
CComBSTR   bstrVar( “test “);
char   *buf   =   </em>com_util::ConvertBSTRToString(bstrVar.m_str);
AfxMessageBox(buf);
delete(buf);
<em>bstr_t变量
</em>bstr_t类型是对BSTR的封装，因为已经重载了=操作符，所以很容易使用
<em>bstr_t   bstrVar( “test “);
const   char   *buf   =   bstrVar;///不要修改buf中的内容
AfxMessageBox(buf);
通用方法(针对非COM数据类型)
用sprintf完成转换
char     buffer[200];
char     c   =   ’1 ‘;
int       i   =   35;
long     j   =   1000;
float   f   =   1.7320534f;
sprintf(   buffer,   “%c “,c);
sprintf(   buffer,   “%d “,i);
sprintf(   buffer,   “%d “,j);
sprintf(   buffer,   “%f “,f);
二、字符串转换为其它数据类型
strcpy(temp, “123 “);
短整型(int)
i   =   atoi(temp);
长整型(long)
l   =   atol(temp);
浮点(double)
d   =   atof(temp);
CString变量
CString   name   =   temp;
BSTR变量
BSTR   bstrValue   =   ::SysAllocString(L “程序员 “);
…///完成对bstrValue的使用
SysFreeString(bstrValue);
CComBSTR变量
CComBSTR类型变量可以直接赋值
CComBSTR   bstrVar1( “test “);
CComBSTR   bstrVar2(temp);
</em>bstr_t变量
<em>bstr_t类型的变量可以直接赋值
</em>bstr_t   bstrVar1( “test “);
<em>bstr_t   bstrVar2(temp);
三、其它数据类型转换到CString
使用CString的成员函数Format来转换,例如:
整数(int)
str.Format( “%d “,i);
浮点数(float)
str.Format( “%f “,i);
字符串指针(char   <em>)等已经被CString构造函数支持的数据类型可以直接赋值
str   =   username;
对于Format所不支持的数据类型，可以通过上面所说的关于其它数据类型转化到char   </em>的方法先转到char   *，然后赋值给CString变量。
四、BSTR、</em>bstr_t与CComBSTR
CComBSTR   是ATL对BSTR的封装，<em>bstr_t是C++对BSTR的封装,BSTR是32位指针,但并不直接指向字串的缓冲区。
char   *转换到BSTR可以这样:
BSTR   b=</em>com_util::ConvertStringToBSTR( “数据 “);///使用前需要加上comutil.h和comsupp.lib
SysFreeString(bstrValue);
反之可以使用
char   <em>p=<em>com_util::ConvertBSTRToString(b);
delete   p;
具体可以参考一，二段落里的具体说明。
CComBSTR与</em>bstr_t对大量的操作符进行了重载，可以直接进行=,!=,==等操作，所以使用非常方便。
特别是<em>bstr_t,建议大家使用它。
五、VARIANT   、</em>variant_t   与   COleVariant
VARIANT的结构可以参考头文件VC98IncludeOAIDL.H中关于结构体tagVARIANT的定义。
对于VARIANT变量的赋值：首先给vt成员赋值，指明数据类型，再对联合结构中相同数据类型的变量赋值，举个例子：
VARIANT   va;
int   a=2001;
va.vt=VT_I4;///指明整型数据
va.lVal=a;   ///赋值
对于不马上赋值的VARIANT，最好先用Void   VariantInit(VARIANTARG   FAR</em>   pvarg);进行初始化,其本质是将vt设置为VT_EMPTY,下表我们列举vt与常用数据的对应关系:
 </p>

<table style="outline-width: 0px; outline-style: initial; outline-color: initial; font-size: 14px; border-collapse: collapse; padding: 0px; margin: 0px; border: 0px initial initial;"><tbody style="outline-width: 0px; outline-style: initial; outline-color: initial; font-size: 14px; padding: 0px; margin: 0px; border: 0px initial initial;"><tr style="outline-width: 0px; outline-style: initial; outline-color: initial; font-size: 14px; padding: 0px; margin: 0px; border: 0px initial initial;">
<td class="line_numbers" style="padding-top: 2px; padding-right: 4px; padding-bottom: 2px; padding-left: 4px; outline-width: 0px; outline-style: initial; outline-color: initial; font-size: 14px; vertical-align: top; text-align: right; background-color: #ddeeff; color: gray; overflow-x: visible; overflow-y: visible; margin: 0px; border: 0px initial initial;">


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1
</span><span class='line'>2
</span><span class='line'>3
</span><span class='line'>4
</span><span class='line'>5
</span><span class='line'>6
</span><span class='line'>7
</span><span class='line'>8
</span><span class='line'>9
</span><span class='line'>10
</span><span class='line'>11
</span><span class='line'>12
</span><span class='line'>13
</span><span class='line'>14
</span><span class='line'>15
</span><span class='line'>16
</span><span class='line'>17
</span><span class='line'>18
</span><span class='line'>19
</span><span class='line'>20
</span><span class='line'>21
</span><span class='line'>22
</span><span class='line'>23
</span><span class='line'>24
</span><span class='line'>25
</span><span class='line'>26
</span><span class='line'>27
</span><span class='line'>28
</span><span class='line'>29
</span><span class='line'>30
</span><span class='line'>31
</span><span class='line'>32
</span><span class='line'>33
</span><span class='line'>34
</span><span class='line'>35
</span><span class='line'>36
</span><span class='line'>37
</span><span class='line'>38
</span><span class='line'>39</span></code></pre></td></tr></table></div></figure>


</td>
<td class="code" style="padding-top: 2px; padding-right: 4px; padding-bottom: 2px; padding-left: 4px; outline-width: 0px; outline-style: initial; outline-color: initial; font-size: 14px; vertical-align: top; margin: 0px; border: 0px initial initial;">


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1
</span><span class='line'>2
</span><span class='line'>3
</span><span class='line'>4
</span><span class='line'>5
</span><span class='line'>6
</span><span class='line'>7
</span><span class='line'>8
</span><span class='line'>9
</span><span class='line'>10
</span><span class='line'>11
</span><span class='line'>12
</span><span class='line'>13
</span><span class='line'>14
</span><span class='line'>15
</span><span class='line'>16
</span><span class='line'>17
</span><span class='line'>18
</span><span class='line'>19
</span><span class='line'>20
</span><span class='line'>21
</span><span class='line'>22
</span><span class='line'>23
</span><span class='line'>24
</span><span class='line'>25
</span><span class='line'>26
</span><span class='line'>27
</span><span class='line'>28
</span><span class='line'>29
</span><span class='line'>30
</span><span class='line'>31
</span><span class='line'>32
</span><span class='line'>33
</span><span class='line'>34
</span><span class='line'>35
</span><span class='line'>36
</span><span class='line'>37
</span><span class='line'>38
</span><span class='line'>39</span></code></pre></td></tr></table></div></figure>


</td>
</tr></tbody></table>


<p> 
<em>variant_t是VARIANT的封装类，其赋值可以使用强制类型转换，其构造函数会自动处理这些数据类型。
使用时需加上#include   &lt;comdef.h>
例如：
long   l=222;
ing   i=100;
</em>variant_t   lVal(l);
lVal   =   (long)i;
COleVariant的使用与_variant_t的方法基本一样，请参考如下例子：
COleVariant   v3   =   “字符串 “,   v4   =   (long)1999;
CString   str   =(BSTR)v3.pbstrVal;
long   i   =   v4.lVal;
六、其它一些COM数据类型
根据ProgID得到CLSID
HRESULT   CLSIDFromProgID(   LPCOLESTR   lpszProgID,LPCLSID   pclsid);
CLSID   clsid;
CLSIDFromProgID(   L “MAPI.Folder “,&amp;clsid);
根据CLSID得到ProgID
WINOLEAPI   ProgIDFromCLSID(   REFCLSID   clsid,LPOLESTR   *   lplpszProgID);
例如我们已经定义了   CLSID_IApplication,下面的代码得到ProgID
LPOLESTR   pProgID   =   0;
ProgIDFromCLSID(   CLSID_IApplication,&amp;pProgID);
…///可以使用pProgID
CoTaskMemFree(pProgID);//不要忘记释放
七、ANSI与Unicode
Unicode称为宽字符型字串,COM里使用的都是Unicode字符串。
将ANSI转换到Unicode
(1)通过L这个宏来实现，例如:   CLSIDFromProgID(   L “MAPI.Folder “,&amp;clsid);
(2)通过MultiByteToWideChar函数实现转换,例如:
char   *szProgID   =   “MAPI.Folder “;
WCHAR   szWideProgID[128];
CLSID   clsid;
long   lLen   =   MultiByteToWideChar(CP_ACP,0,szProgID,strlen(szProgID),szWideProgID,sizeof(szWideProgID));
szWideProgID[lLen]   =   ‘ ‘;
(3)通过A2W宏来实现,例如:
USES_CONVERSION;
CLSIDFromProgID(   A2W(szProgID),&amp;clsid);
将Unicode转换到ANSI
(1)使用WideCharToMultiByte,例如:
//   假设已经有了一个Unicode   串   wszSomeString…
char   szANSIString   [MAX_PATH];
WideCharToMultiByte   (   CP_ACP,   WC_COMPOSITECHECK,   wszSomeString,   -1,   szANSIString,   sizeof(szANSIString),   NULL,   NULL   );
(2)使用W2A宏来实现,例如:
USES_CONVERSION;
pTemp=W2A(wszSomeString);
八、其它
对消息的处理中我们经常需要将WPARAM或LPARAM等32位数据（DWORD)分解成两个16位数据（WORD),例如：
LPARAM   lParam;
WORD   loValue   =   LOWORD(lParam);///取低16位
WORD   hiValue   =   HIWORD(lParam);///取高16位
对于16位的数据(WORD)我们可以用同样的方法分解成高低两个8位数据(BYTE),例如:
WORD   wValue;
BYTE   loValue   =   LOBYTE(wValue);///取低8位
BYTE   hiValue   =   HIBYTE(wValue);///取高8位
两个16位数据（WORD）合成32位数据(DWORD,LRESULT,LPARAM,或WPARAM)
LONG   MAKELONG(   WORD   wLow,   WORD   wHigh   );
WPARAM   MAKEWPARAM(   WORD   wLow,   WORD   wHigh   );
LPARAM   MAKELPARAM(   WORD   wLow,   WORD   wHigh   );
LRESULT   MAKELRESULT(   WORD   wLow,   WORD   wHigh   );
两个8位的数据(BYTE)合成16位的数据(WORD)
WORD   MAKEWORD(   BYTE   bLow,   BYTE   bHigh   );
从R(red),G(green),B(blue)三色得到COLORREF类型的颜色值
COLORREF   RGB(   BYTE   byRed,BYTE   byGreen,BYTE   byBlue   );
例如COLORREF   bkcolor   =   RGB(0×22,0×98,0×34);
从COLORREF类型的颜色值得到RGB三个颜色值
BYTE   Red   =   GetRValue(bkcolor);   ///得到红颜色
BYTE   Green   =   GetGValue(bkcolor);   ///得到绿颜色
BYTE   Blue   =   GetBValue(bkcolor);   ///得到兰颜色
九、注意事项
假如需要使用到ConvertBSTRToString此类函数,需要加上头文件comutil.h,并在setting中加入comsupp.lib或者直接加上#pragma   comment(   lib,   “comsupp.lib ”   )</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">zhanlang</span></span>

      








  


<time datetime="2011-04-10T00:00:00+08:00" pubdate data-updated="true">Apr 10<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/c-c-/'>c/c++</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/04/10/cpp-forward-declaration/" title="Previous Post: c++中的前向声明">&laquo; c++中的前向声明</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/04/10/cpp-xml-library/" title="Next Post: c++XML库">c++XML库 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/12/24/hello-octopress/">hello octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/23/qtqq-v070-beta/">Qtqq v0.7.0-beta</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/23/about-qtqq0-8-0-alpha/">关于qtqq0.8.0-alpha</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/20/typecho-rewrite-rule/">typecho rewrite 规则</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/20/sae-wordpress--zhuan--typecho/">sae wordpress 转 typecho</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/zhanlangsir">@zhanlangsir</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'zhanlangsir',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - zhanlang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
